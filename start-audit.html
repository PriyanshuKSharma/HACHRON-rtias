<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start Audit</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #1e1e2d;
            color: white;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2><i class="fas fa-warehouse"></i> Inventory</h2>
        <ul>
            <li onclick="window.location.href='dashboad.html'"><i class="fas fa-tachometer-alt"></i> Dashboard</li>
        </ul>
    </div>
    <div class="main-content">
        <header>
            <h1><i class="fas fa-clipboard-check"></i> Full Physical Inventory Audit</h1>
        </header>
        <section class="recent-files">
            <h2>Audit Data</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Index</th>
                            <th>Product</th>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Quantity</th>
                            <th>Brand</th>
                            <th>Sales Volume</th>
                            <th>Normalized Demand</th>
                            <th>Demand Category</th>
                            <th>Inventory Strategy</th>
                        </tr>
                    </thead>
                    <tbody id="audit-data-table">
                        <!-- Data will be inserted dynamically -->
                    </tbody>
                </table>
            </div>
        </section>
    </div>
    <footer>
        <p>&copy; 2025 Warehouse Audit Systems</p>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Try to load the CSV file but provide a fallback demo data button
            fetch('blinkit.csv')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(csvText => {
                    const data = parseCSV(csvText);
                    displayInventoryData(data);
                })
                .catch(error => {
                    console.error('Error loading CSV:', error);
                    
                    // Show a more helpful message with a button to load demo data
                    const container = document.querySelector('.table-container');
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 5px; margin-bottom: 20px;">
                            <h3>Unable to load inventory data due to browser security restrictions</h3>
                            <p>Your browser cannot load local files directly due to security policies.</p>
                            <p><strong>Solutions:</strong></p>
                            <ol style="text-align: left; display: inline-block;">
                                <li>Use VS Code Live Server extension</li>
                                <li>Run a Python HTTP server: <code>python -m http.server</code></li>
                            </ol>
                            <button id="load-demo-data" style="background: #4d79ff; color: white; border: none; padding: 10px 15px; border-radius: 5px; margin-top: 15px; cursor: pointer;">Load Sample Data for Testing</button>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Index</th>
                                    <th>Product</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                    <th>Brand</th>
                                    <th>Sales Volume</th>
                                    <th>Normalized Demand</th>
                                    <th>Demand Category</th>
                                    <th>Inventory Strategy</th>
                                </tr>
                            </thead>
                            <tbody id="audit-data-table">
                                <!-- Data will be inserted dynamically -->
                            </tbody>
                        </table>
                    `;
                    
                    // Add event listener for the demo data button
                    document.getElementById('load-demo-data').addEventListener('click', function() {
                        const sampleData = [
                            {index: 1, product: "Colgate Toothpaste", category: "Household Essentials", price: "475.85", quantity: "156", brand: "Colgate", "sales volume": "12", normalized_demand: "0.1590909091", demand_category: "Low Demand", inventory_strategy: "Stored in secondary locations, replenished as needed"},
                            {index: 2, product: "Britannia Cookies", category: "Bakery", price: "86.45", quantity: "264", brand: "Britannia", "sales volume": "15", normalized_demand: "0.2272727273", demand_category: "Low Demand", inventory_strategy: "Stored in secondary locations, replenished as needed"},
                            {index: 3, product: "Amul Butter", category: "Dairy", price: "304.55", quantity: "201", brand: "Amul", "sales volume": "7", normalized_demand: "0.0454545455", demand_category: "Low Demand", inventory_strategy: "Stored in secondary locations, replenished as needed"}
                        ];
                        displayInventoryData(sampleData);
                        this.disabled = true;
                        this.textContent = "Sample Data Loaded";
                    });
                });
        });

        // Function to parse CSV text into an array of objects
        function parseCSV(csvText) {
            // Split into lines and get header row
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',').map(header => header.trim());
            
            // Process each data row
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                // Handle cases where a field might contain commas within quotes
                const row = {};
                let currentLine = lines[i];
                const values = [];
                let insideQuotes = false;
                let currentValue = '';
                
                // Parse CSV properly handling quoted values
                for (let j = 0; j < currentLine.length; j++) {
                    const char = currentLine[j];
                    if (char === '"') {
                        insideQuotes = !insideQuotes;
                    } else if (char === ',' && !insideQuotes) {
                        values.push(currentValue.trim());
                        currentValue = '';
                    } else {
                        currentValue += char;
                    }
                }
                values.push(currentValue.trim()); // Add the last value
                
                // Create object from headers and values
                headers.forEach((header, index) => {
                    // Clean up any quotes around values
                    let value = values[index] || '';
                    if (value.startsWith('"') && value.endsWith('"')) {
                        value = value.substring(1, value.length - 1);
                    }
                    row[header] = value;
                });
                
                data.push(row);
            }
            
            return data;
        }

        function displayInventoryData(data) {
            let table = document.getElementById('audit-data-table');
            table.innerHTML = '';
            
            data.forEach(item => {
                // Convert string values to appropriate types for display
                const index = parseInt(item.index) || item.index;
                const price = parseFloat(item.price) || 0;
                const quantity = parseInt(item.quantity) || 0;
                const salesVolume = parseInt(item['sales volume'] || item.sales_volume) || 0;
                const normalizedDemand = parseFloat(item.normalized_demand) || 0;
                
                let row = `<tr>
                    <td>${index}</td>
                    <td>${item.product}</td>
                    <td>${item.category}</td>
                    <td>â‚¹${price.toFixed(2)}</td>
                    <td>${quantity}</td>
                    <td>${item.brand}</td>
                    <td>${salesVolume}</td>
                    <td>${normalizedDemand.toFixed(2)}</td>
                    <td>${item.demand_category}</td>
                    <td>${item.inventory_strategy}</td>
                </tr>`;
                table.innerHTML += row;
            });
        }
    </script>
</body>
</html>
